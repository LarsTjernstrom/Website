<dom-element is="puppet-import">
    <style></style>
    <template></template>
    <script>
        Polymer({
            oldModel: null,
            oldHtml: null,
            is: "puppet-import",
            ready: function () {
                this.originalNotifyPath = this.notifyPath;

                this.notifyPath = function (path, value) {
                    if (this.template) {
                        this.template.notifyPath(path, value);
                    }

                    this.originalNotifyPath(path, value);
                };

                this.loadContent();
            },
            loadContent: function () {
                if (!this.content) {
                    return;
                }

                var that = this;
                var req = new XMLHttpRequest();

                req.onload = function () {
                    that.set("html", this.responseText);
                };

                req.open("GET", this.content, true);
                req.send();
            },
            stampTemplate: function () {
                if (!this.html || !this.model) {
                    this.template = null;
                    this.root.innerHTML = "";
                    return;
                }

                if (this.oldModel == this.model && this.oldHtml == this.html && this.template) {
                    return;
                }

                if (this.oldHtml == this.html && this.template) {
                    this.template.set("model", this.model);
                    return;
                }

                if (this.template) {
                    this.root.innerHTML = "";
                    //Polymer.dom(this.parentNode).removeChild(this.template);
                }

                this.template = document.createElement('template', 'dom-bind');
                this.template.model = this.model;
                this.template.innerHTML = this.html;

                Polymer.dom(this.root).appendChild(this.template);
            },
            properties: {
                html: {
                    type: String,
                    value: null,
                    observer: "htmlChanged"
                },
                content: {
                    type: String,
                    value: null,
                    observer: "contentChanged"
                },
                model: {
                    type: Object,
                    value: null,
                    observer: "modelChanged"
                },
                path: {
                    type: String,
                    value: ""
                }
            },
            modelChanged: function (newValue, oldValue) {
                this.stampTemplate();
                this.oldModel = newValue;
            },
            htmlChanged: function (newValue, oldValue) {
                this.stampTemplate();
                this.oldHtml = newValue;
            },
            contentChanged: function (newValue, oldValue) {
                this.loadContent();
            }
        });
    </script>
</dom-element>